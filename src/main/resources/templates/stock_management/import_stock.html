<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head >
    <title>WMS - Workspace</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="WMS" />
    <!--CSS-->
    <link rel='stylesheet' href="css/bootstrap.css" th:href="@{/css/bootstrap.css}"  type='text/css' />
    <link rel="stylesheet" href="css/bootstrap-table.css" th:href="@{/css/bootstrap-table.css}"/>
    <link rel='stylesheet' href="css/style.css" th:href="@{/workspace_resource/css/style.css}"  type='text/css' />
    <link rel="stylesheet" href="css/animate.css"  th:href="@{/workspace_resource/css/animate.css}"  type="text/css" media="all"/>
    <link rel="stylesheet" href="/fonts/font-awesome/css/font-awesome.min.css" th:href="@{/fonts/font-awesome/css/font-awesome.min.css}"/>

    <link rel="stylesheet" href="/css/bootstrap-combobox.css" th:href="@{/css/bootstrap-combobox.css}"/>
    <link rel="stylesheet" href="/css/bootstrap-toggle.css" th:href="@{/css/bootstrap-toggle.css}"/>
    <!--script-->
    <script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
    <script th:attr="src=@{/js/wow.min.js}"  th:href="@{/js/wow.min.js}"></script>
    <script>
                new WOW().init();
    </script>
    <script th:attr="src=@{/js/jquery-1.10.2.min.js}" th:href="@{/js/jquery-1.10.2.min.js}"></script>
    <script th:attr="src=@{/js/bootstrap-table.js}"  th:href="@{/js/bootstrap-table.js}"></script>
    <script th:attr="src=@{/js/bootstrap-combobox.js}"  th:href="@{/js/bootstrap-combobox.js}"></script>
    <!--confirmation-->
    <script th:attr="src=@{/js/bootstrap.min.js}"  th:href="@{/js/bootstrap.min.js}"></script>
    <script th:attr="src=@{/js/validator.js}"      th:href="@{/js/validator.js}"></script>
    <!--common-->
    <script th:attr="src=@{/js/wms-common.js}"      th:href="@{/js/wms-common.js}"></script>
    <!--font and favi icon-->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet"/>
    <link rel="shortcut icon" th:href="@{/images/wms_favicon.ico}"/>

</head>
<body class="sticky-header left-side-collapsed">
<section>
    <!--left menu-->
    <div th:include="common/workspace_leftmenu :: frag-leftmenu"></div>
    <!--main content-->
    <div class="main-content main-content2 main-content2copy">
        <div th:include="common/header :: frag-headermneu"></div>
        <div id="page-wrapper">
            <!--search panel-->
            <div id="panel-search-content" class="panel panel-primary">
                <div class="panel-heading">
                    <i class="fa fa-search"></i>
                    <!--Search info-->
                </div>
                <div class="panel-body">
                    <div class="container">
                        <!--row 1: customer + stock-->
                        <div class="row">
                            <div class="col-sm-2">
                                <label th:text="#{lbl.usage}"></label>
                            </div>

                            <div class="col-sm-4">
                                <div class="input-group">
                                    <label id="lblCustomer" th:utext="${session.selectedCustomer.name}"></label>
                                    <label id="lbl-customerId" style="display: none" th:text="${session.selectedCustomer.id}"></label>
                                </div>
                            </div>
                            <div class="col-sm-2">
                                <label th:text="#{lbl.stock}"></label>
                            </div>
                            <div class="col-sm-4">
                                <div class="input-group">
                                    <select id="cmb-stock" class="combobox form-control">
                                        <option  th:each="sopt:${lstStock}"
                                                 th:value="${sopt.id}" th:text="${sopt.name}">1</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <!--row 2: contract number + invoice-->
                        <div class="row">
                            <div class="col-sm-2">
                                <label th:text="#{lbl.contracnumber}" for="inp-contract-number"></label>
                            </div>
                            <div class="col-sm-4">
                                <div class="input-group">
                                    <span class="input-group-addon">
                                            <i class="fa fa-book fa-fw"></i>
                                        </span>
                                    <input id="inp-contract-number" class="form-control" type="text" />
                                </div>
                            </div>
                            <div class="col-sm-2">
                                <label th:text="#{lbl.invoice}" for="inp-invoice"></label>
                            </div>
                            <div class="col-sm-4">
                                <div class="input-group">
                                    <span class="input-group-addon">
                                            <i class="fa fa-table fa-fw"></i>
                                        </span>
                                    <input id="inp-invoice" class="form-control" type="text" />
                                </div>
                            </div>
                        </div>
                        <!--note-->
                        <!--row 3: note-->
                        <div class="row">
                            <div class="col-sm-2">
                                <label th:text="#{lbl.note}" for="inp-contract-note"></label>
                            </div>
                            <div class="col-sm-10">
                                <div class="input-group">
                                    <span class="input-group-addon">
                                            <i class="fa fa-sticky-note fa-fw"></i>
                                        </span>
                                    <textarea id="inp-contract-note" class="form-control" type="text" th:rows="2"/>
                                </div>
                            </div>
                        </div>

                        <!--row 4: file uploa-->
                        <div class="row">
                            <div class="col-sm-2">
                                <label th:text="#{lbl.fileupload}" for="inp-contract-note"></label>
                            </div>
                            <div class="col-sm-5">
                                <div class="input-group">
                                    <div class="input-group">
                                        <input id="inp-file-import" checked="true" data-toggle="toggle" type="file"/>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-5">
                                <div class="input-group">
                                    <button type="button" th:text="#{btn.importfile}" class="btn btn-default  btn-primary"
                                            id="btn-excel-import" th:value="@{/workspace/stock_management/upload}">
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <p></p>

                </div>
            </div>
            <!--end search panel-->
            <div id="panel-search-result" class="panel panel-primary">
                <div class="panel-heading">
                    <i class="fa fa-database"></i>
                    <!--Result-->
                </div>
                <div class="panel-body">
                    <!--toolbar-->
                    <div id="toolbar" class="btn-group">
                        <button id="btn-add" th:value="@{/workspace/stock_management/add}" type="button" class="btn btn-default">
                            <i class="fa fa-plus"></i>
                        </button>
                        <button id="btn-update" th:value="@{/workspace/stock_management/update}" type="button" class="btn btn-default">
                            <i class="fa fa-edit"></i>
                        </button>
                        <button id="btn-delete" th:value="@{/workspace/stock_management/delete}" type="button" class="btn btn-default">
                            <i class="fa fa-trash"></i>
                        </button>
                        <button id="btn-import-excel" th:value="@{/workspace/stock_management/importExcel}" type="button" class="btn btn-default">
                            <i class="fa fa-file-excel-o"></i>
                        </button>

                        <label class="action-info" id="action-info" th:if="${actionInfo != null} " th:text="#{${actionInfo}}" th:style="${successStyle}"></label>
                        <label id="del-action-info"></label>
                    </div>
                    <table  id="tbl-import-goods"
                            data-pagination="true"
                            data-search="true"
                            data-click-to-select="true"
                            data-show-columns="true"
                            data-toolbar="#toolbar"
                            class="table-striped"
                            style="word-wrap: break-word;  table-layout: fixed;"
                    >

                        <thead>
                        <tr>
                            <th   minimumCountColumns="true" data-field="id" data-formatter="runningFormatter" data-align="center">STT</th>
                            <th   minimumCountColumns="true" data-checkbox="true"></th>
                            <th   class="col-md-2" data-field="goodsCode" data-align="left" data-sortable="true">Mã hàng</th>
                            <th   class="col-md-3" data-field="goodsName" data-align="left" data-sortable="true">Tên hàng</th>
                            <th   data-field="goodsState" data-align="left" data-sortable="true">Trạng thái</th>
                            <th   class="col-md-1" data-field="serial" data-align="left" data-sortable="true">Serial</th>
                            <th   data-field="amountValue" data-align="right" data-sortable="true">Số lượng</th>
                            <th   data-field="inputPriceValue" data-align="right" data-sortable="true">Giá nhập</th>
                            <th   data-field="outputPriceValue" data-align="right" data-sortable="true">Giá xuất</th>
                            <th   data-field="cellCode" data-align="left" data-sortable="true">Vị trí</th>
                            <th   data-field="columnId" data-align="left" data-sortable="true">ColumnId</th>
                        </tr>
                        </thead>
                    </table>
                </div>

                <div class="wrapper text-center" style="text-align: center;">
                    <div class="btn-group" role="group" aria-label="Basic example">
                        <button type="button" th:text="#{btn.import}" class="btn btn-default  btn-primary"
                                id="btn-import" th:value="@{/workspace/stock_management/import}">
                        </button>
                    </div>
                </div>

                <p></p>

            </div>
        </div>
    </div>
    <!--footer-->
    <div th:include="common/footer :: frag-footer"></div>
</section>

<!--FINAL JS-->
<script th:attr="src=@{/js/jquery.nicescroll.js}" th:href="@{/js/jquery.nicescroll.js}"></script>
<script th:attr="src=@{/js/scripts.js}" th:href="@{/js/scripts.js}"></script>
<!--switch-->
<script th:attr="src=@{/js/bootstrap-toggle.min.js}" th:href="@{/js/bootstrap-toggle.min.js}"></script>
<script>
    //---------------------------------------------------------------------
    //		init empty data
    var dataInit = [
    ];
    $(function () {
        $('#tbl-import-goods').bootstrapTable({
            data: dataInit
        });
        //
        $('.combobox').combobox();
        //
        $('#tbl-import-goods').bootstrapTable('hideColumn', 'columnId');
    });
    //---------------------------------------------------------------------
    var btnUploadExcel = $('#btn-excel-import');
    $(function () {
        btnUploadExcel.click(function () {
            //
            var data = new FormData();
            jQuery.each(jQuery('#inp-file-import')[0].files, function(i, file) {
                data.append('file-'+i, file);
            });
            //
            $.ajax({
                url: btnUploadExcel.val(),
                data: data,
                cache: false,
                contentType: false,
                processData: false,
                type: 'POST',
                success: function(data){
                    $('#tbl-import-goods').bootstrapTable('load', data);
                },
                error: function(data){
                    alert(data);
                }
            });
        });

    });
    //@Import---------------------------------------------------------------------
    var btnImport = $('#btn-import');
    $(function () {
        btnImport.click(function () {
            var contractNumberValue = $('#inp-contract-number').val();
            var invoiceValue = $('#inp-invoice').val();
            var descriptionValue = $('#inp-contract-note').val();
            var stockIdValue = $('#cmb-stock').val();
            var stock_trans_info = {contractNumber:contractNumberValue,invoiceNumber:invoiceValue,stockId:stockIdValue,description:descriptionValue};
            //
            var importData = JSON.stringify({lstGoods:$('#tbl-import-goods').bootstrapTable('getData'),mjrStockTransDTO:stock_trans_info});
            //
            $.ajax({
                url: btnImport.val(),
                data:importData,
                cache: false,
                contentType: "application/json",
                dataType: 'text',
                type: 'POST',
                success: function(data){
                    alert(data);
                },
                error: function(data){
                    alert('Error: '+ data);
                }
            });
        });

    });

    //@Del action---------------------------------------------------------------------------------------------------
    var $btnDel = $('#btn-delete');
    var selectedDelItem;
    $(function () {
        $btnDel.click(function () {
            clearActionInfo()
            var ids = $.map($('#tbl-import-goods').bootstrapTable('getSelections'), function (row) {
                return row.columnId;
            });
            $('#tbl-import-goods').bootstrapTable('remove', {
                field: 'columnId',
                values: ids
            });

        });
    });


</script>
</body>
</html>