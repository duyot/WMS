<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head >
    <title>WMS - Workspace</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="WMS" />
    <!--CSS-->
    <link rel='stylesheet' href="css/bootstrap.css" th:href="@{/css/bootstrap.css}"  type='text/css' />
    <link rel="stylesheet" href="css/bootstrap-table.css" th:href="@{/css/bootstrap-table.css}"/>
    <link rel='stylesheet' href="css/style.css" th:href="@{/workspace_resource/css/style.css}"  type='text/css' />
    <link rel="stylesheet" href="css/animate.css"  th:href="@{/workspace_resource/css/animate.css}"  type="text/css" media="all"/>
    <link rel="stylesheet" href="/fonts/font-awesome/css/font-awesome.min.css" th:href="@{/fonts/font-awesome/css/font-awesome.min.css}"/>

    <link rel="stylesheet" href="/css/bootstrap-combobox.css" th:href="@{/css/bootstrap-combobox.css}"/>
    <link rel="stylesheet" href="/css/bootstrap-toggle.css" th:href="@{/css/bootstrap-toggle.css}"/>
    <!--script-->
    <script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
    <script th:attr="src=@{/js/wow.min.js}"  th:href="@{/js/wow.min.js}"></script>
    <script>
                new WOW().init();
    </script>
    <script th:attr="src=@{/js/jquery-1.10.2.min.js}" th:href="@{/js/jquery-1.10.2.min.js}"></script>
    <script th:attr="src=@{/js/bootstrap-table.js}"  th:href="@{/js/bootstrap-table.js}"></script>
    <script th:attr="src=@{/js/bootstrap-combobox.js}"  th:href="@{/js/bootstrap-combobox.js}"></script>
    <!--confirmation-->
    <script th:attr="src=@{/js/bootstrap.min.js}"  th:href="@{/js/bootstrap.min.js}"></script>
    <script th:attr="src=@{/js/validator.js}"      th:href="@{/js/validator.js}"></script>
    <!--common-->
    <script th:attr="src=@{/js/wms-common.js}"      th:href="@{/js/wms-common.js}"></script>
    <!--font and favi icon-->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet"/>
    <link rel="shortcut icon" th:href="@{/images/wms_favicon.ico}"/>

</head>
<body class="sticky-header left-side-collapsed">
<section>
    <!--left menu-->
    <div th:include="common/workspace_leftmenu :: frag-leftmenu"></div>
    <!--main content-->
    <div class="main-content main-content2 main-content2copy">
        <div th:include="common/header :: frag-headermneu"></div>
        <div id="page-wrapper">
            <!--search panel-->
            <div id="panel-search-content" class="panel panel-primary">
                <div class="panel-heading">
                    <i class="fa  fa-search"></i>
                    <!--Search info-->
                </div>
                <div class="panel-body">
                    <div class="container">
                        <!--row 1: username + status-->
                        <div class="row">
                            <div class="col-sm-2">
                                <label th:text="#{lbl.usage}"></label>
                            </div>

                            <div class="col-sm-4">
                                <div class="input-group">
                                <label id="lblCustomer" th:utext="${session.selectedCustomer.name}"></label>
                                <label id="lbl-customerId" style="display: none" th:text="${session.selectedCustomer.id}"></label>
                                </div>
                            </div>
                            <div class="col-sm-2">
                                <label th:text="#{lbl.status}"></label>
                            </div>
                            <div class="col-sm-4">
                                <div class="input-group">
                                    <input id="cmb-status" checked="true" data-toggle="toggle" type="checkbox"/>
                                </div>
                            </div>
                        </div>

                    </div>

                    <p></p>

                    <div class="wrapper text-center" style="text-align: center;">
                        <div class="btn-group" role="group" aria-label="Basic example">
                            <button type="button" th:text="#{btn.search}" class="btn btn-default  btn-primary"
                                    id="btn-search-cat-group" th:value="@{/workspace/cat_partner_ctr/findByCondition}">
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!--end search panel-->
            <div id="panel-search-result" class="panel panel-primary">
                <div class="panel-heading">
                    <i class="fa fa-database"></i>
                    <!--Result-->
                </div>
                <div class="panel-body">
                    <!--toolbar-->
                    <div id="toolbar" class="btn-group">
                        <button id="btn-add" th:value="@{/workspace/cat_partner_ctr/add}" type="button" class="btn btn-default">
                            <i class="fa fa-plus"></i>
                        </button>
                        <button id="btn-update" th:value="@{/workspace/cat_partner_ctr/update}" type="button" class="btn btn-default">
                            <i class="fa fa-edit"></i>
                        </button>
                        <button id="btn-delete" th:value="@{/workspace/cat_partner_ctr/delete}" type="button" class="btn btn-default">
                            <i class="fa fa-trash"></i>
                        </button>

                        <label class="action-info" id="action-info" th:if="${actionInfo != null} " th:text="#{${actionInfo}}" th:style="${successStyle}"></label>
                        <label id="del-action-info"></label>
                    </div>
                    <table  id="table-pagination"
                            data-pagination="true"
                            data-search="true"
                            data-click-to-select="true"
                            data-show-columns="true"
                            data-toolbar="#toolbar"
                            class="table-striped"
                    >

                        <thead>
                        <tr>
                            <th  class="col-md-1" data-formatter="runningFormatter" data-align="center">STT</th>
                            <th  class="col-md-1" data-checkbox="true"></th>
                            <th  class="col-md-2" data-field="code" data-align="left" data-sortable="true" th:text="#{lbl.partnerCode}"></th>
                            <th  class="col-md-3" data-field="name" data-align="left" data-sortable="true" th:text="#{lbl.partnerName}"></th>
                            <th  class="col-md-1" data-field="telNumber" data-align="left" data-sortable="true" th:text="#{lbl.telNumber}"></th>
                            <th  class="col-md-3" data-field="address" data-align="left" data-sortable="true" th:text="#{lbl.address}"></th>
                            <th  class="col-md-2" data-field="statusValue" data-align="left" data-sortable="true" th:text="#{lbl.status}" ></th>
                        </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <!--modal-->
        <div th:include="modal/cat_partner_modal :: frag-cat-partner-modal"></div>
    <div th:include="modal/confirm_modal :: frag-confirm-modal"></div>
    <!--footer-->
    <div th:include="common/footer :: frag-footer"></div>
</section>

<!--FINAL JS-->
<script th:attr="src=@{/js/jquery.nicescroll.js}" th:href="@{/js/jquery.nicescroll.js}"></script>
<script th:attr="src=@{/js/scripts.js}" th:href="@{/js/scripts.js}"></script>
<!--switch-->
<script th:attr="src=@{/js/bootstrap-toggle.min.js}" th:href="@{/js/bootstrap-toggle.min.js}"></script>
<script>
    //		row num
    function runningFormatter(value, row, index) {
        return index +1;
    }
    //		init empty data
    var dataInit = [
    ];

    //@Init component-----------------------------------------------------------------------------------------------
    $(function () {
        $('#table-pagination').bootstrapTable({
            data: dataInit
        });

        $('.combobox').combobox();

        //fill data to table
        search(false);
    });

    function search(isClear){
        if(isClear){
            clearActionInfo()
        }

        var customerIdVal   = $('#lbl-customerId').text();
        var statusVal;
        if($('#cmb-status').prop('checked')){
            statusVal = '1';
        }else{
            statusVal = '0';
        }

        $.ajax({
            type: "GET",
            cache:false,
            data:{customerId:customerIdVal,status:statusVal},
            contentType: "application/x-www-form-urlencoded; charset=UTF-8",
            url: $btnSearch.val(),
            dataType: 'json',
            timeout: 600000,
            success: function (data) {
                $('#table-pagination').bootstrapTable('load', data);
            },
        });
    }
    //@Del action---------------------------------------------------------------------------------------------------
    var $btnDel = $('#btn-delete');
    var selectedDelItem;
    $(function () {
        $btnDel.click(function () {
            clearActionInfo()
            var selectedItemArr = $('#table-pagination').bootstrapTable('getSelections');
            var selectedItem    = selectedItemArr[0];
            if(selectedItem == null){
                alert('Chọn 1 bản ghi');
                return;
            }
            $("#lbl-del-info").text('Xóa thông tin: '+ selectedItem['name']);
            $('#myConfirmModal').modal('show');
        });
    });

    var $btnDelConfirmed = $('#modal-btn-del-ok');
    $btnDelConfirmed.click(function () {
        //
        var selectedItemArr = $('#table-pagination').bootstrapTable('getSelections');
        var selectedItem    = selectedItemArr[0];
        idVal = selectedItem['id'];
        $.ajax({
            type: "POST",
            cache:false,
            data:{id:idVal},
            contentType: "application/x-www-form-urlencoded; charset=UTF-8",
            url: $btnDel.val(),
            dataType: 'text',
            timeout: 600000,
            success: function (data) {
                resultArr = data.split('|');
                resultCode = resultArr[0];
                resultName = resultArr[1];
                if(resultCode == 1){
                    document.getElementById("del-action-info").style = 'color:#337ab7';
                }
                document.getElementById("del-action-info").innerHTML = resultName;
                search(false);

            },
            error:function(){
                document.getElementById("del-action-info").innerHTML = 'Lỗi hệ thống';
            },
        });
        //
        $('#myConfirmModal').modal('hide');
        //
    });

    //@SEARCH ACTION------------------------------------------------------------------------------------------------
    var $btnSearch = $('#btn-search-cat-group');
    $(function () {
        $btnSearch.click(function () {
            search(true);
        });
    });
    //@Login action-------------------------------------------------------------------------------------------------
    var $btnLogin = $('#login');
    $(function () {
        $btnLogin.click(function () {
            $.ajax({
                type: "GET",
                contentType: "application/x-www-form-urlencoded; charset=UTF-8",
                url: $btnLogin.val(),
                dataType: 'text',
                timeout: 600000,
                success: function (data) {
                    document.getElementById("login-info").innerHTML = data;
                }
            });
        });
    });

    //@Add action---------------------------------------------------------------------------------------------------
    $btn_add = $('#btn-add');
    $(function () {
        $btn_add.click(function () {
            clearActionInfo();
            changeModelByType(1,null,$btn_add.val());
            $('#myModal').modal('show');
            $("#myModal").on('shown.bs.modal', function () {
                $('#modal-inp-code').focus();
            });
        });
    });
    //@Update action------------------------------------------------------------------------------------------------
    $btn_update = $('#btn-update');
    $(function () {
        $btn_update.click(function () {
            clearActionInfo();
            //check before show
            selectedItemArr = $('#table-pagination').bootstrapTable('getSelections');
            selectedItem    = selectedItemArr[0];
            if(selectedItem == null){
                alert('Chọn 1 bản ghi!');
                return;
            }
            changeModelByType(2,selectedItem,$btn_update.val());
            $('#myModal').modal('show');
            $("#myModal").on('shown.bs.modal', function () {
                $('#modal-inp-code').focus();
            });

        });
    });

    function changeModelByType(type,selectedItem,actionVal) {
        $("#cat-insert-update-form").attr("th:object",actionVal);
        if(type == 1){//add
            $("#cat-insert-update-form").attr("action",actionVal);
            $("#modal-inp-code").val('');
            $("#modal-inp-name").val('');
            $("#modal-inp-telNumber").val('');
            $("#modal-inp-address").val('');
            //set default active-disable combo status
            $('#modal-cmb-status').bootstrapToggle('on');
            $("#div-status *").prop('disabled',true);

            showAdd();
            $("#myModalLabel").text('Thêm mới');
        }else{//update
            $("#cat-insert-update-form").attr("action",actionVal);
            $("#modal-inp-code").val(decodeHtml(selectedItem["code"]));
            $("#modal-inp-name").val(decodeHtml(selectedItem["name"]));
            $("#modal-inp-telNumber").val(decodeHtml(selectedItem["telNumber"]));
            $("#modal-inp-address").val(decodeHtml(selectedItem["address"]));
            $("#modal-inp-id").val(selectedItem["id"]);
            var currentStatus = selectedItem["status"];
            if(currentStatus == '0'){
                $('#modal-cmb-status').bootstrapToggle('off');
            }else{
                $('#modal-cmb-status').bootstrapToggle('on');
            }
            $("#div-status *").prop('disabled',false);
            showUpdate();
        }

    }
</script>

</body>
</html>