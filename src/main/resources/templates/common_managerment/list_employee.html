<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head >
	<title>WMS - Workspace</title>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content="WMS" />
	<!--CSS-->
	<link rel='stylesheet' href="css/bootstrap.css" th:href="@{/css/bootstrap.css}"  type='text/css' />
	<link rel="stylesheet" href="css/bootstrap-table.css" th:href="@{/css/bootstrap-table.css}"/>
	<link rel='stylesheet' href="css/style.css" th:href="@{/workspace_resource/css/style.css}"  type='text/css' />
	<link rel="stylesheet" href="css/animate.css"  th:href="@{/workspace_resource/css/animate.css}"  type="text/css" media="all"/>
	<link rel="stylesheet" href="/fonts/font-awesome/css/font-awesome.min.css" th:href="@{/fonts/font-awesome/css/font-awesome.min.css}"/>
    <link rel="stylesheet" href="/css/daterangepicker.css" th:href="@{/css/daterangepicker.css}"/>
    <!--script-->
    <script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
    <script th:attr="src=@{/js/wow.min.js}"  th:href="@{/js/wow.min.js}"></script>
    <script>
                new WOW().init();
    </script>
    <script th:attr="src=@{/js/jquery-1.10.2.min.js}" th:href="@{/js/jquery-1.10.2.min.js}"></script>
    <script th:attr="src=@{/js/bootstrap-table.js}"  th:href="@{/js/bootstrap-table.js}"></script>
    <!--confirmation-->
    <script th:attr="src=@{/js/bootstrap.min.js}"  th:href="@{/js/bootstrap.min.js}"></script>
    <script th:attr="src=@{/js/validator.js}"      th:href="@{/js/validator.js}"></script>
    <!--datetime-->
    <script th:attr="src=@{/js/moment.min.js}"      th:href="@{/js/moment.min.js}"></script>
    <script th:attr="src=@{/js/daterangepicker.js}" th:href="@{/js/daterangepicker.js}"></script>
    <script th:attr="src=@{/js/wms-common.js}"      th:href="@{/js/wms-common.js}"></script>

</head>
<body class="sticky-header left-side-collapsed">
    <section>
		<!--left menu-->
		<div th:include="common/workspace_leftmenu :: frag-leftmenu"></div>
		<!--main content-->
		<div class="main-content main-content2 main-content2copy">
			<div th:include="common/header :: frag-headermneu"></div>
			<div id="page-wrapper">
				<!--search panel-->
				<div id="panel-search-content" class="panel panel-primary">
					<div class="panel-heading">
						<i class="fa  fa-search"></i>
						Search info
					</div>
					<div class="panel-body">
						<div class="container">
							<!--row 1: username + status-->
							<div class="row">
								<div class="col-sm-2">
									<label>Tên tài khoản</label>
								</div>

								<div class="col-sm-4">
									<div class="input-group">
										<span class="input-group-addon">
											<i class="fa fa-catUserDTO-o fa-fw"></i>
										</span>
										<input id="inp-username" type="text" class="form-control"  placeholder="User name"/>
									</div>
								</div>
								<div class="col-sm-2">
									<label>Trạng thái</label>

								</div>
								<div class="col-sm-4">
									<div class="input-group">
										<select id="cmb-status" class="combobox form-control">
											<option value="-1">Tất cả</option>
											<option value="1">Hiệu lực</option>
											<option value="0">Hết hiệu lực</option>
										</select>
									</div>
								</div>
							</div>
							<!--row 2: email + vai tro-->
							<div class="row">
								<div class="col-sm-2">
									<label>Email</label>
								</div>
								<div class="col-sm-4">
									<div class="input-group">
										<span class="input-group-addon">
											<i class="fa fa-envelope-o fa-fw"></i>
										</span>
										<input id="inp-email" type="email" class="form-control"  placeholder="Email"/>
									</div>
								</div>

								<div class="col-sm-2">
									<label>Vai trò</label>

								</div>
								<div class="col-sm-4">
									<div class="input-group">
										<select id="cmb-role" class="combobox form-control">
											<option value="-1">Tất cả</option>
                                            <option th:each="sopt:${mapRoles.entrySet()}"
                                                    th:value="${sopt.key}" th:text="${sopt.value}">Admin</option>
											<!--<option value="1">Admin</option>-->
											<!--<option value="2">CatUserDTO</option>-->
										</select>
									</div>
								</div>
							</div>
                            <!--row 3: datetime-->
                            <div class="row">
                                <div class="col-sm-2">
                                    <label>Ngày tạo</label>
                                </div>
                                <div class="col-sm-4">
                                    <div class="input-group">
										<span class="input-group-addon">
											<i class="fa fa-calendar fa-fw"></i>
										</span>
                                        <input type="text" id="create-date-range" class="form-control" name="daterange" value="01/01/2015 - 31/01/2015" />
                                    </div>
                                </div>
                            </div>
						</div>

						<p></p>

						<div class="wrapper text-center" style="text-align: center;">
							<div class="btn-group" role="group" aria-label="Basic example">
								<button type="button" class="btn btn-default  btn-primary" id="btn-load-data" th:value="@{/workspace/getuser}">
									Search
								</button>
							</div>
						</div>
					</div>
				</div>
				<!--end search panel-->
				<div id="panel-search-result" class="panel panel-primary">
					<div class="panel-heading">
						<i class="fa fa-database"></i>
						Result
					</div>
					<div class="panel-body">
                    <!--toolbar-->
                            <div id="toolbar" class="btn-group">
                            <button id="btn-add" th:value="@{/workspace/add}" type="button" class="btn btn-default">
                            <i class="fa fa-plus"></i>
							</button>
							<button id="btn-update" th:value="@{/workspace/update}" type="button" class="btn btn-default">
								<i class="fa fa-edit"></i>
							</button>
							<button id="btn-delete" th:value="@{/workspace/delete}" type="button" class="btn btn-default">
								<i class="fa fa-trash"></i>
							</button>

                            <label class="action-info" id="action-info"  th:text="${actionInfo}" th:style="${successStyle}"></label>
							<label id="del-action-info"></label>
                    </div>
						<table  id="table-pagination"
								data-pagination="true"
								data-search="true"
								data-click-to-select="true"
								data-toolbar="#toolbar"
								class="table-striped"
						>

							<thead>
							<tr>
								<th  class="col-md-1" data-checkbox="true"></th>
								<th  class="col-md-1" data-formatter="runningFormatter" data-align="center">STT</th>
								<th  class="col-md-1" data-field="userId" data-align="center" data-sortable="true">ID</th>
								<th  class="col-md-3" data-field="username" data-align="left" data-sortable="true">Tài khoản </th>
								<th  class="col-md-3" data-field="email" data-align="left" data-sorter="true">Email</th>
								<th  class="col-md-2" data-field="roleName" data-align="left" data-sorter="true">Vai trò</th>
								<th  class="col-md-1" data-field="status" data-align="left" data-sorter="true">Trạng thái</th>
							</tr>
							</thead>
						</table>
					</div>
				</div>
			</div>
		</div>
		<!--modal-->
		<div th:include="modal/add_user_modal :: frag-add-catUserDTO-modal"></div>
		<div th:include="modal/confirm_modal :: frag-confirm-modal"></div>
		<!--footer-->
		<div th:include="common/footer :: frag-footer"></div>
	</section>

	<!--FINAL JS-->
	<script th:attr="src=@{/js/jquery.nicescroll.js}" th:href="@{/js/jquery.nicescroll.js}"></script>
	<script th:attr="src=@{/js/scripts.js}" th:href="@{/js/scripts.js}"></script>

	<script>
//		row num
		function runningFormatter(value, row, index) {
			return index +1;
		}
//		init empty data
		var dataInit = [
		];

		//@Init component-----------------------------------------------------------------------------------------------
		$(function () {
			$('#table-pagination').bootstrapTable({
				data: dataInit
			});

            initDateRangeSelect();
		});

        $btnShowTime = $('#btn-show-time');

        $btnShowTime.click(function () {


        });
		//@Del action---------------------------------------------------------------------------------------------------
        var $btnDel = $('#btn-delete');
        var selectedDelItem;
		$(function () {
			$btnDel.click(function () {
				var selectedItemArr = $('#table-pagination').bootstrapTable('getSelections');
				var selectedItem    = selectedItemArr[0];
				if(selectedItem == null){
					alert('Chọn 1 bản ghi');
					return;
				}
				$("#lbl-del-info").text('Xóa thông tin: '+ selectedItem['username']);
				$('#myConfirmModal').modal('show');
			});
		});

		var $btnDelConfirmed = $('#modal-btn-del-ok');
		$btnDelConfirmed.click(function () {
			//
			var selectedItemArr = $('#table-pagination').bootstrapTable('getSelections');
			var selectedItem    = selectedItemArr[0];
			userIdVal = selectedItem['userId'];
			$.ajax({
				type: "POST",
				cache:false,
				data:{userId:userIdVal},
				contentType: "application/x-www-form-urlencoded; charset=UTF-8",
				url: $btnDel.val(),
				dataType: 'text',
				timeout: 600000,
				success: function (data) {
					resultArr = data.split('|');
					resultCode = resultArr[0];
					resultName = resultArr[1];
					if(resultCode == 1){
						document.getElementById("del-action-info").style = 'color:#337ab7';
					}
					document.getElementById("del-action-info").innerHTML = resultName;
					$('#btn-load-data').trigger('click');

				},
				error:function(){
					document.getElementById("del-action-info").innerHTML = 'Lỗi hệ thống';
				},
			});
			//
			$('#myConfirmModal').modal('hide');
			//
		});

		//@SEARCH ACTION------------------------------------------------------------------------------------------------
		var $btnSearch = $('#btn-load-data');
		$(function () {
			$btnSearch.click(function () {
                clearActionInfo();
				var emailVal    = $('#inp-email').val();
				var usernameVal = $('#inp-username').val();
				var statusVal   = $('#cmb-status').val();
				var roleVal     = $('#cmb-role').val();
                var drp = $('#create-date-range').data('daterangepicker');
                var startDateVal = drp.startDate.format("DD/MM/YYYY");
                var endDateVal   = drp.endDate.format("DD/MM/YYYY");
				$.ajax({
					type: "GET",
					cache:false,
					data:{username:usernameVal,email:emailVal,status:statusVal,role:roleVal,startDate:startDateVal,endDate:endDateVal},
					contentType: "application/x-www-form-urlencoded; charset=UTF-8",
					url: $btnSearch.val(),
					dataType: 'json',
					timeout: 600000,
					success: function (data) {
						$('#table-pagination').bootstrapTable('load', data);
					},
				});
			});
		});
		//@Login action-------------------------------------------------------------------------------------------------
		var $btnLogin = $('#login');
		$(function () {
			$btnLogin.click(function () {
				$.ajax({
					type: "GET",
					contentType: "application/x-www-form-urlencoded; charset=UTF-8",
					url: $btnLogin.val(),
					dataType: 'text',
					timeout: 600000,
					success: function (data) {
						document.getElementById("login-info").innerHTML = data;
					}
				});
			});
		});

		//@Add action---------------------------------------------------------------------------------------------------
		$btn_add = $('#btn-add');
		$(function () {
			$btn_add.click(function () {
                clearActionInfo();
				changeModelByType(1,null,$btn_add.val());
				$('#myModal').modal('show');
			});
		});
		//@Update action------------------------------------------------------------------------------------------------
		$btn_update = $('#btn-update');
		$(function () {
			$btn_update.click(function () {
                clearActionInfo();
				//check before show
				selectedItemArr = $('#table-pagination').bootstrapTable('getSelections');
				selectedItem    = selectedItemArr[0];
				if(selectedItem == null){
					alert('Chọn 1 bản ghi!');
					return;
				}
				changeModelByType(2,selectedItem,$btn_update.val());
				$('#myModal').modal('show');
			});
		});

		function changeModelByType(type,selectedItem,actionVal) {
            $("#catUserDTO-insert-update-form").attr("th:object",actionVal);
			if(type == 1){//add
                $("#catUserDTO-insert-update-form").attr("action",actionVal);

				$("#myModalLabel").text('Thêm mới');
				$("#modal-inp-username").val('');
				$("#modal-inp-email").val('');

				$("#modal-btn-update").hide();
				$("#modal-btn-add").show();
			}else{//update
                $("#catUserDTO-insert-update-form").attr("action",actionVal);
				$("#myModalLabel").text('Cập nhật');
				$("#modal-inp-username").val(selectedItem["username"]);
				$("#modal-inp-email").val(selectedItem["email"]);
                //
				$("#modal-inp-userId").val(selectedItem["userId"]);
				$("#modal-inp-password").val(selectedItem["password"]);
				$("#modal-inp-createdDate").val(selectedItem["createdDate"]);
				$("#modal-inp-imgUrl").val(selectedItem["imgUrl"]);
				$("#modal-inp-roleName").val(selectedItem["roleName"]);
				$("#modal-cmb-roleundefined").val(selectedItem["roleName"]);
				var statusValue = selectedItem["status"] == 1?'Hiệu lực':"Hết hiệu lực";
				$("#modal-cmb-statusundefined").val(statusValue);

				$("#modal-btn-update").show();
				$("#modal-btn-add").hide();
			}
		}
//		delete action
	</script>

</body>
</html>