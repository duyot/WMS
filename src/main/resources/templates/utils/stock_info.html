<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head >
    <title>WMS - Workspace</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="WMS" />
    <!--CSS-->
    <link rel='stylesheet'  th:href="@{/css/bootstrap.css}"  type='text/css' />
    <link rel="stylesheet"  th:href="@{/css/bootstrap-table.css}"/>
    <link rel='stylesheet'  th:href="@{/workspace_resource/css/style.css}"  type='text/css' />
    <link rel="stylesheet"  th:href="@{/workspace_resource/css/animate.css}"  type="text/css" media="all"/>
    <link rel="stylesheet"  th:href="@{/fonts/font-awesome/css/font-awesome.min.css}"/>

    <link rel="stylesheet" th:href="@{/css/bootstrap-select.min.css}"/>
    <link rel="stylesheet" th:href="@{/css/bootstrap-toggle.css}"/>
    <!--script-->
    <script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
    <script th:attr="src=@{/js/wow.min.js}"  th:href="@{/js/wow.min.js}"></script>
    <script>
        new WOW().init();
    </script>
    <script th:attr="src=@{/js/jquery-1.10.2.min.js}" th:href="@{/js/jquery-1.10.2.min.js}"></script>
    <script th:attr="src=@{/js/bootstrap-table.js}"  th:href="@{/js/bootstrap-table.js}"></script>
    <script th:attr="src=@{/js/bootstrap-select.min.js}"  th:href="@{/js/bootstrap-select.min.js}"></script>
    <!--confirmation-->
    <script th:attr="src=@{/js/bootstrap.min.js}"  th:href="@{/js/bootstrap.min.js}"></script>
    <!--<script th:attr="src=@{/js/validator.js}"      th:href="@{/js/validator.js}"></script>-->
    <!--common-->
    <script th:attr="src=@{/js/wms-common.js}"      th:href="@{/js/wms-common.js}"></script>
    <!--font and favi icon-->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet"/>
    <link rel="shortcut icon" th:href="@{/images/wms_favicon.ico}"/>

</head>
<body class="sticky-header left-side-collapsed">
<section>
    <!--left menu-->
    <div th:include="common/workspace_leftmenu :: frag-leftmenu"></div>
    <!--main content-->
    <div class="main-content main-content2 main-content2copy">
        <div th:include="common/header :: frag-headermneu"></div>
        <div id="page-wrapper">
            <!--search panel-->
            <div id="panel-search-content" class="panel panel-primary">
                <div class="panel-heading">
                    <i class="fa fa-search"></i>
                    <!--Search info-->
                </div>
                <div class="panel-body">
                    <form>
                        <div class="container">
                            <!--row 1: customer + stock-->
                            <div class="row">
                                <div class="col-sm-2">
                                    <label th:text="#{lbl.usage}"></label>
                                </div>

                                <div class="col-sm-4">
                                    <div class="input-group">
                                        <label id="lblCustomer" th:utext="${session.selectedCustomer.name}"></label>
                                        <button id="btn-get-goods-detail" style="display: none" th:value="@{/workspace/utils/stockInfo/getGoodsDetail}"></button>
                                    </div>
                                </div>
                                <div class="col-sm-2">
                                    <label for="cmb-stock" th:text="#{lbl.stock}"></label>
                                </div>
                                <div class="col-sm-4">
                                    <div class="input-group input-group-combo">
                                        <select id="cmb-stock" class="selectpicker form-control" data-live-search="true"
                                                data-width="100%" name="cmb-stock">
                                            <option value="-1" th:text="#{label.all}"></option>
                                            <option  th:each="sopt:${lstStock}"
                                                     th:value="${sopt.id}" th:text="${sopt.name}">1</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <!--row 2: goods group - goods -->
                            <div class="row">
                                <div class="col-sm-2">
                                    <label th:text="#{lbl.goods}" for="cmb-goods"></label>
                                </div>
                                <div class="col-sm-4">
                                    <div class="input-group input-group-combo">
                                        <select id="cmb-goods" class="selectpicker form-control"  data-live-search="true"
                                                data-width="100%" name="cmb-goods">
                                            <option value="-1" th:text="#{label.all}"></option>
                                            <option  th:each="sopt:${lstGoods}"
                                                     th:value="${sopt.id}" th:text="${sopt.name}">1</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="col-sm-2">
                                    <label>Trạng thái</label>

                                </div>
                                <div class="col-sm-4">
                                    <div class="input-group input-group-combo">
                                        <select id="cmb-status" class="selectpicker form-control" data-live-search="true"
                                                data-width="100%" name="cmb-status">
                                            <option value="-1" th:text="#{label.all}"></option>
                                            <option  th:each="sopt:${lstAppGoodsState}"
                                                     th:value="${sopt.code}" th:text="${sopt.name}">1</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                    <div class="wrapper text-center" style="text-align: center; margin-top: 3px">
                        <div class="btn-group" role="group" aria-label="Basic example">
                            <button type="button" th:text="#{btn.search}" class="btn btn-default  btn-primary"
                                    id="btn-search-stock-info" th:value="@{/workspace/utils/stockInfo/findByCondition}">
                            </button>
                        </div>
                    </div>

                    <p></p>

                </div>
            </div>
            <!--end search panel-->
            <div id="panel-search-result" class="panel panel-primary">
                <div class="panel-heading">
                    <i class="fa fa-database"></i>
                    <!--Result-->
                </div>
                <div class="panel-body">
                    <!--toolbar-->
                    <div id="toolbar" class="btn-group">
                        <button id="btn-refresh-table" type="button"
                                class="btn btn-default" th:title="#{tooltip.cleartabble}" >
                            <i class="fa fa-refresh"></i>
                        </button>

                        <a class="btn btn-default" th:title="#{link.downloadfile}" th:href="@{/workspace/utils/stockInfo/getTotalFile}">
                            <i class="fa fa-download"></i>
                        </a>

                        <label class="action-info action-info-link" id="action-info"></label>
                    </div>
                    <table  id="tbl-stock-info"
                            data-pagination="true"
                            data-search="true"
                            data-click-to-select="true"
                            data-show-columns="true"
                            data-toolbar="#toolbar"
                            class="table-striped"
                            style="word-wrap: break-word;  table-layout: fixed;"
                    >

                        <thead>
                        <tr>
                            <th data-field="id" data-formatter="runningFormatter" data-align="center" data-width="40px">STT</th>
                            <th class="col-md-2" data-field="goodsCode" data-align="left" data-sortable="true">Mã</th>
                            <th class="col-md-2" data-field="goodsName" data-align="left" data-sortable="true">Tên</th>
                            <th data-field="goodsStateName" data-align="left" data-sortable="true">TT</th>
                            <th data-field="stockName" data-align="left" data-sortable="true">Kho</th>
                            <th data-field="amountValue" data-align="right" data-sortable="true">SL</th>
                            <th data-field="changeDate" data-align="right" data-sortable="true">TG cập nhật</th>
                            <th data-field="stockId" data-align="right" data-sortable="true"></th>
                            <th data-field="goodsState" data-align="right" data-sortable="true"></th>
                            <th data-field="goodsId" data-align="right" data-sortable="true"></th>
                            <th data-align="center"  data-events="operateEvents" data-formatter="operateFormatter"></th>
                        </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-loading"><!-- Place at bottom of page --></div>
    <div th:include="modal/goods_details_modal :: frag-goods-detail-modal"></div>
    <!--footer-->
    <div th:include="common/footer :: frag-footer"></div>
</section>

<!--FINAL JS-->
<script th:attr="src=@{/js/jquery.nicescroll.js}" th:href="@{/js/jquery.nicescroll.js}"></script>
<script th:attr="src=@{/js/scripts.js}" th:href="@{/js/scripts.js}"></script>
<!--switch-->
<script th:attr="src=@{/js/bootstrap-toggle.min.js}" th:href="@{/js/bootstrap-toggle.min.js}"></script>
<!--validation-->
<script th:attr="src=@{/js/jquery.form-validator.min.js}" th:href="@{/js/jquery.form-validator.min.js}"></script>
<script>
    //---------------------------------------------------------------------
    $table = $('#tbl-stock-info');
    $tableGoodsDetail = $('#tbl-goods-detail');
    var dataInit = [
    ];

    $(function () {
        //
        $table.bootstrapTable({
            data: dataInit
        });
        //
        $tableGoodsDetail.bootstrapTable({
            data: dataInit,
            pageList:[5,10, 25, 50],
            pageSize:5
        });
        $table.bootstrapTable('hideColumn', 'stockId');
        $table.bootstrapTable('hideColumn', 'goodsState');
        $table.bootstrapTable('hideColumn', 'goodsId');
        //
    });
    //
    function operateFormatter(value, row, index) {
        return [
            '<a class="view-goods-detail" href="javascript:void(0)" title="Chi tiết">',
            '<i class="fa fa-info-circle"></i>',
            '</a>  '
        ].join('');
    }
    //
    $body = $("body");
    window.operateEvents = {
        'click .view-goods-detail': function (e, value, row, index) {
            //get goods detail info
            $body.addClass("loading");
            $.ajax({
                type: "GET",
                cache:false,
                data:{stockId:row['stockId'],goodsId:row['goodsId'],goodsState:row['goodsState']},
                contentType: "application/x-www-form-urlencoded; charset=UTF-8",
                url: $('#btn-get-goods-detail').val(),
                dataType: 'json',
                timeout: 600000,
                async:false,
                success: function (data) {
                    $tableGoodsDetail.bootstrapTable('load', data);
                    var $downloadLink = $('#link-download-goods-detail');
                    var originalLink = $downloadLink.attr("href");
                    if(originalLink.includes("?")){
                        originalLink = trimAtChacter(originalLink,"?");
                    }
                    $downloadLink.attr("href",originalLink +"?stockId="+row['stockId']);
                    showModal($('#goods-detail-modal'));
                },
                complete: function(){
                    $body.removeClass("loading");
                }
            });
            //

        }
    };

    //@Search-----------------------------------------------------------------
    var $btnSearch = $('#btn-search-stock-info');
    $btnSearch.click(function () {
        search();
    });

    function search(){
        $("#action-info").text('');
        //search info stock_id/goods_group/goods/serial
        var stock_id = $('#cmb-stock').val();
        var goods_id = $('#cmb-goods').val();
        var statusVal =  $('#cmb-status').val();

        $.ajax({
            type: "GET",
            cache:false,
            data:{stockId:stock_id,goodsId:goods_id,status:statusVal},
            contentType: "application/x-www-form-urlencoded; charset=UTF-8",
            url: $btnSearch.val(),
            dataType: 'json',
            timeout: 600000,
            success: function (data) {
                $table.bootstrapTable('load', data);
                if(isTableEmpty($table)){
                    setInfoMessage($('#action-info'),"Không tìm thấy dữ liệu");
                }
            }
        });
    }
    //@Refresh table----------------------------------------------------------
    $('#btn-refresh-table').click(function () {
        $table.bootstrapTable('removeAll');
        $("#action-info").text('');
        //
    });
    //-------------------------------------------------------------------------
</script>
</body>
</html>